'use strict';var StackedMenu=function(e){this.options={compact:!1,hoverable:!1,closeOther:!0,align:'right',selector:'#stacked-menu',selectorClass:'stacked-menu'},this.options=this._extend({},this.options,e),this.selector=document.querySelector(this.options.selector),this.items=this.selector?this.selector.querySelectorAll('.menu-item'):null,Array.prototype.forEach||(Array.prototype.forEach=function(e,t){if('function'!=typeof e)throw new TypeError(e+' is not a function');var s=this;t=t||this;for(var i=0;i<s.length;i++)e.call(t,s[i],i,s)}),this.each=Array.prototype.forEach,this.classes={alignLeft:this.options.selectorClass+'-has-left',compact:this.options.selectorClass+'-has-compact',collapsible:this.options.selectorClass+'-has-collapsible',hoverable:this.options.selectorClass+'-has-hoverable',hasChild:'has-child',hasActive:'has-active',hasOpen:'has-open'},this.active=null,this.open=[],this.handlerClickDoc=[],this.handlerOver=[],this.handlerOut=[],this.handlerClick=[],this.init()};StackedMenu.prototype._onReady=function(e){'loading'!=document.readyState?e():document.addEventListener('DOMContentLoaded',e,!1)},StackedMenu.prototype._extend=function(e){e=e||{};for(var t=arguments,s=1;s<t.length;s++)if(t[s])for(var i in t[s])t[s].hasOwnProperty(i)&&(e[i]=t[s][i]);return e},StackedMenu.prototype._emit=function(e,t){var s;document.createEvent?(s=document.createEvent('Event'),s.initEvent(e,!0,!0)):(s=document.createEventObject(),s.eventType=e),s.eventName=e,s.data=t||this,document.createEvent?this.selector.dispatchEvent(s):this.selector.fireEvent('on'+e,s)},StackedMenu.prototype._hover=function(e,t,s){'A'===e.tagName?(this._on(e,'focus',t),this._on(e,'blur',s)):(this._on(e,'mouseover',t),this._on(e,'mouseout',s))},StackedMenu.prototype._on=function(e,t,s){for(var i=t.split(' '),n=0;n<i.length;n++)e[window.addEventListener?'addEventListener':'attachEvent'](window.addEventListener?i[n]:'on'+i[n],s,!1)},StackedMenu.prototype._off=function(e,t,s){for(var i=t.split(' '),n=0;n<i.length;n++)e[window.removeEventListener?'removeEventListener':'detachEvent'](window.removeEventListener?i[n]:'on'+i[n],s,!1)},StackedMenu.prototype._addClass=function(e,t){for(var s=t.split(' '),i=0;i<s.length;i++)e.classList?e.classList.add(s[i]):e.classes[i]+=' '+s[i]},StackedMenu.prototype._removeClass=function(e,t){for(var s=t.split(' '),i=0;i<s.length;i++)e.classList?e.classList.remove(s[i]):e.classes[i]=e.classes[i].replace(new RegExp('(^|\\b)'+s[i].split(' ').join('|')+'(\\b|$)','gi'),' ')},StackedMenu.prototype._hasClass=function(e,t){return e.classList?e.classList.contains(t):new RegExp('(^| )'+t+'( |$)','gi').test(e.className)},StackedMenu.prototype._hasChild=function(e){return this._hasClass(e,this.classes.hasChild)},StackedMenu.prototype._hasActive=function(e){return this._hasClass(e,this.classes.hasActive)},StackedMenu.prototype._hasOpen=function(e){return this._hasClass(e,this.classes.hasOpen)},StackedMenu.prototype._isLevelMenu=function(e){return this._hasClass(e.parentNode.parentNode,this.options.selectorClass)},StackedMenu.prototype._menuTrigger=function(e,t){var s=e.querySelector('a');this._off(e,'mouseover',this.handlerOver[t]),this._off(e,'mouseout',this.handlerOut[t]),this._off(s,'focus',this.handlerOver[t]),this._off(s,'blur',this.handlerOut[t]),this._off(e,'click',this.handlerClick[t]),this.handlerOver[t]=this.openMenu.bind(this,e),this.handlerOut[t]=this.closeMenu.bind(this,e),this.handlerClick[t]=this.toggleMenu.bind(this,e),this.isHoverable()?this._hasChild(e)&&(this._hover(e,this.handlerOver[t],this.handlerOut[t]),this._hover(s,this.handlerOver[t],this.handlerOut[t])):this._on(e,'click',this.handlerClick[t])},StackedMenu.prototype._handleInteractions=function(e){var t=this;this.each.call(e,function(e,s){t._hasChild(e)&&t._menuTrigger(e,s),t._hasActive(e)&&(t.active=e)})},StackedMenu.prototype._getSubhead=function(e){return e.querySelector('.menu-text').textContent},StackedMenu.prototype._generateSubhead=function(){var e,t,s,i,n=this,o=this.selector.children;this.each.call(o,function(o){n.each.call(o.children,function(o){n._hasChild(o)&&(n.each.call(o.children,function(t){n._hasClass(t,'menu-link')&&(e=t)}),t=e.nextElementSibling,s=document.createElement('li'),i=document.createTextNode(n._getSubhead(e)),s.appendChild(i),n._addClass(s,'menu-subhead'),t.insertBefore(s,t.firstChild))})})},StackedMenu.prototype._handleTabIndex=function(){var e=this;this.each.call(this.items,function(t){var s=t.parentNode.parentNode;e._isLevelMenu(t)||t.querySelector('a').setAttribute('tabindex','-1'),(e._hasActive(s)||e._hasOpen(s))&&t.querySelector('a').removeAttribute('tabindex')})},StackedMenu.prototype._slide=function(e,t,s,i){s=s||300,i=i||'ease';var n=this,o=e.querySelector('.menu'),a=window.getComputedStyle(e).height,h=s+50,l=h+100;if(o.style.transition='height '+s+'ms '+i+', opacity '+s/2+'ms '+i+', visibility '+s/2+'ms '+i,'down'===t){e.style.overflow='hidden',e.style.height=a,o.style.height='auto';var r=window.getComputedStyle(o).height;o.style.height=0,o.style.visibility='hidden',o.style.opacity=0,e.style.overflow='',e.style.height='',setTimeout(function(){o.style.height=r,o.style.opacity=1,o.style.visibility='visible'},0)}else if('up'===t){var c=window.getComputedStyle(o).height;o.style.height=c,o.style.visibility='visible',o.style.opacity=1,setTimeout(function(){o.style.height=0,o.style.visibility='hidden',o.style.opacity=0},0)}var u=new Promise(function(s){setTimeout(function(){s(e),n._emit('menu:slide'+t)},h)});return setTimeout(function(){o.removeAttribute('style')},l),u},StackedMenu.prototype.init=function(){var e=this,t=this.options;this._addClass(this.selector,t.selectorClass),this._generateSubhead(),this.compact(t.compact),this.hoverable(t.hoverable),this._handleTabIndex(),this.each.call(this.items,function(t){e._on(t,'click',function(s){s.stopPropagation(),e._hasChild(t)&&s.preventDefault()})}),this._on(document.body,'click',function(){!e.isHoverable()&&e.isCompact()&&e.closeAllMenu()}),this._onReady(function(){e._emit('menu:init')})},StackedMenu.prototype.openMenu=function(e,t){if(void 0===t&&(t=!0),!this._hasActive(e)||this.isCompact()){var s=this,i=this._isLevelMenu(e)&&this.isCompact();if(this.isHoverable()||i?(this._addClass(e,this.classes.hasOpen),this._handleTabIndex()):this._slide(e,'down',150,'linear').then(function(){s._addClass(e,s.classes.hasOpen),s._handleTabIndex()}),this.open.push(e),this.isHoverable()||this.isCompact()&&!this.hoverable()){var n=document.documentElement.clientHeight,o=e.querySelector('.menu'),a=o.getBoundingClientRect(),h=a.height-20,l=n-a.top,r='left'===this.options.align?'100%':'0px';(a.top>=500||h>=l)&&(o.style.top='auto',o.style.bottom=0,o.style.transformOrigin=r+' 100% 0')}return t&&this._emit('menu:open'),this}},StackedMenu.prototype.closeMenu=function(e,t){void 0===t&&(t=!0);var s=this,i=this._isLevelMenu(e)&&this.isCompact();if(this.isHoverable()||i?(this._removeClass(e,this.classes.hasOpen),this._handleTabIndex()):this._hasActive(e)||this._slide(e,'up',150,'linear').then(function(){s._removeClass(e,s.classes.hasOpen),s._handleTabIndex()}),this.each.call(this.open,function(t,i){e==t&&s.open.splice(i,1)}),this.isHoverable()||this.isCompact()&&!this.hoverable()){var n=e.querySelector('.menu');n.style.top='',n.style.bottom='',n.style.transformOrigin=''}return t&&this._emit('menu:close'),this},StackedMenu.prototype.closeAllMenu=function(){var e=this;return this.each.call(this.items,function(t){e._hasOpen(t)&&e.closeMenu(t,!1)}),this},StackedMenu.prototype.toggleMenu=function(e){var t,s,i=this._hasOpen(e)?'closeMenu':'openMenu',n=this;return this.each.call(this.items,function(i){t=i.parentNode.parentNode,s=e.parentNode.parentNode,!n._hasOpen(s)&&n._hasChild(t)&&(n.options.closeOther||!n.options.closeOther&&n.isCompact())&&n._hasOpen(t)&&n.closeMenu(t,!1)}),this._hasChild(e)&&this[i](e),this},StackedMenu.prototype.align=function(e){var t='left'===e?'_addClass':'_removeClass',s=this.classes;return this[t](this.selector,s.alignLeft),this.options.align=e,this._emit('menu:align'),this},StackedMenu.prototype.isCompact=function(){return this.options.compact},StackedMenu.prototype.compact=function(e){var t=e?'_addClass':'_removeClass',s=this.classes;return this[t](this.selector,s.compact),this.options.compact=e,this._handleInteractions(this.items),this._emit('menu:compact'),this},StackedMenu.prototype.isHoverable=function(){return this.options.hoverable},StackedMenu.prototype.hoverable=function(e){var t=this.classes;return e?(this._addClass(this.selector,t.hoverable),this._removeClass(this.selector,t.collapsible)):(this._addClass(this.selector,t.collapsible),this._removeClass(this.selector,t.hoverable)),this.options.hoverable=e,this._handleInteractions(this.items),this._emit('menu:hoverable'),this},module.exports=StackedMenu;
//# sourceMappingURL=stacked-menu.min.js.map
